@page
@model FPP.Presentation.Pages.Security.SecurityLogModel

<h2 class="mb-3">Security Logs</h2>
<a asp-page="/Security/CreateSecurityLog"
   asp-route-eventId="@Model.EventId"
   class="btn btn-primary mb-3">Create New Log</a>

<a asp-page="/Security/SecurityDetails"
   asp-route-id="@Model.EventId"
   class="btn btn-secondary mb-3">
	Back to Event Details
</a>

<table class="table table-striped table-hover">
	<thead>
		<tr>
			<th>Timestamp</th>
			<th>Action</th>
			<th>Notes</th>
			<th>Lab Name</th>
			<th>Organizer Name</th>
			<th>Photo</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var log in Model.SecurityLogResponses)
		{
			<tr>
				<td>@log.Timestamp.ToString("dd/MM/yyyy HH:mm")</td>
				<td>@log.Action</td>
				<td>@log.Notes</td>
				<td>@(log.LabName ?? "N/A")</td>
				<td>@(log.OrganizerName ?? "N/A")</td>
				<td>
					@if (!string.IsNullOrEmpty(log.PhotoUrl))
					{
						<a href="@log.PhotoUrl" target="_blank">View</a>
					}
					else
					{
						<span>No Image</span>
					}
				</td>
				<td>
					<a asp-page="/Security/UpdateSecurityLog"
					   asp-route-logId="@log.LogId"
					   asp-route-eventId="@Model.EventId"
					   class="btn btn-primary btn-sm">
						Update
					</a>
				</td>
				<td>
					<form method="post" asp-page-handler="Delete" style="display:inline;">
						<input type="hidden" name="logId" value="@log.LogId" />
						<input type="hidden" name="eventId" value="@Model.EventId" />
						<button type="submit"
								class="btn btn-danger btn-sm"
								onclick="return confirm('Are you sure you want to delete this log?');">
							Delete
						</button>
					</form>

				</td>
			</tr>
		}
	</tbody>
</table>

<nav class="mt-3">
	<ul class="pagination justify-content-center">
		<li class="page-item @(Model.PageIndex <= 1 ? "disabled" : "")">
			<a class="page-link"
			   asp-page="/Security/SecurityLog"
			   asp-route-pageIndex="@(Model.PageIndex - 1)"
			   asp-route-eventId="@Model.EventId">Previous</a>
		</li>

		<li class="page-item">
			<a class="page-link"
			   asp-page="/Security/SecurityLog"
			   asp-route-pageIndex="@(Model.PageIndex + 1)"
			   asp-route-eventId="@Model.EventId">Next</a>
		</li>
	</ul>
</nav>
